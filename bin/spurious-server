#!/usr/bin/env ruby

$: << File.join(File.dirname(__FILE__), '..', 'lib')

require 'spurious/server'
require 'spurious/server/version'
require 'daemons'
require 'eventmachine'
require 'em-synchrony'
require 'spurious/server/options'

options = Spurious::Server::Options.new(ENV)
ENV['DOCKER_HOST'] = options.ssl_docker_host

Daemons.run_proc('.spurious-server', :dir => '~/') do
  EventMachine.synchrony Spurious::Server.handle(options)
end
